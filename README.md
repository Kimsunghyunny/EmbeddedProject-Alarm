# EmbeddedProject-Alarm

아두이노, 임베디드(SM5), 안드로이드 통신 기반 이색 알람 시스템

<br><br>

## 시스템 흐름도

![image](https://user-images.githubusercontent.com/22141977/117795071-c9733880-b288-11eb-920f-96d4b8f5c439.png)

알람 시스템이 시작하면, 사용자가 알람 등록을 할 수 있는 상태가 된다. 사용자가 알람을 등록하면 등록한 알람 시간이 안드로이드로 전송한다. 사용자가 등록한 시간을 전송 받은 안드로이드에서는 알람 시간이 되었는지를 앱의 백그라운드 프로세스에서 검사하고 알람 시간이 되면 안드로이드에서 알람시간이 되었음을 알리는 벨소리가 울리고 , 어떤 센서를 활용하여 알람을 끌 수 있는지와, 현재 알람 시간이 되었음을 알리는 데이터를 아두이노에 전송한다. 안드로이드에서 알람시간이 되었음을 전송받은 아두이노는 부저와 LED 센서를 통해 알람 시간이 되었음을 알리고, 사용자가 안드로이드에서 지정한 센서를 이용하여 알람을 끄는지 여부를 검사한다. 사용자가 지정된 행동을 하였을 경우 아두이노는 알람을 종료하고 안드로이드에도 알람을 종료할 것을 요구한다. 그리고 이를 전달받은 안드로이드 역시 알람을 종료한다. 
그림 8 시스템 흐름도 2


![image](https://user-images.githubusercontent.com/22141977/117795043-c415ee00-b288-11eb-871d-bf119e4fc49f.png)


## 임베디드 시스템 흐름도

![image](https://user-images.githubusercontent.com/22141977/117795150-dd1e9f00-b288-11eb-9fb2-925f6a6d319d.png)

SM5가 구동되기 시작하면 안드로이드와의 통신을 위해 소켓을 생성한다. 소켓 생성후 Bind, Listen 과정을 거친후 서버 소켓에 안드로이드 클라이언트가 접속되면 Accept()가 되고 알람 설정단계로 들어간다. 알람 설정 모드는 크게 원터치 모드와 시간 설정 모드가 있다. 원터치 모드는 하나의 버튼으로 5분뒤, 30분 뒤 , 한시간 뒤 , 현재 시간의 알람을 손쉽게 설정할 수 있고 시간 설정 모드는 기존 알람 시스템과 같이 직접 시간을 입력하여 알람을 설정하는 모드이다. 

## 아두이노 시스템 흐름도

![image](https://user-images.githubusercontent.com/22141977/117795222-f1fb3280-b288-11eb-8cda-42d576426de2.png)

아두이노에 전원이 인가되면, 아두이노는 각종 센서들의 pin setup을 시작한다. LED, Sound,Buzzer,Light, Temperature &Humidity 센서가 Setup이 되면, 블루투스 통신을 시작한다. 
아두이노의 블루 투스 시리얼에 안드로이드에서 전송된 알람이 시작 되었음과 알람을 종료하기 위한 센서 활용 방안이 전송되면 LED, Buzzer가 동작하고 해당 센서 모드가 동작된다. 예를들어 Sound 모드가 안드로이드에서 지시한 알람 종료 명령어라면 사용자가 일정 이상의 소리를 내는지 아두이노는 검사하고, 일정 이상의 소리값이 입력되면 아두이노는 알람을 종료하고 안드로이드에 알람이 종료되었음을 전송한다. 

## 안드로이드 시스템 흐름도

![image](https://user-images.githubusercontent.com/22141977/117795277-fe7f8b00-b288-11eb-98f5-453c5f9d1376.png)

안드로이드 어플리케이션 동작이 실행되면 wifi와 bluetooth 연결을 한다. 본 시스템에서 안드로이드는 일종의 신호 중계역할을 하므로, 아두이노나 SM5에서 들어오는 신호를 기다린다. 만약 이전에 설정한 알람 시간이 되었을 경우 안드로이드의 백그라운드 컴포넌트인 서비스를 실행하고, 알람이 울리기 시작한다. SM5나 아두이노에서 데이터 전송이 들어오면, SM5의 경우 알람 데이터를 등록하고 아두이노의 경우 알람을 종료시킨다. 모든 역할이 끝난 안드로이드는 다시 waiting 상태가 된다. 
안드로이드와 아두이노 간의 데이터 전송 포맷과 안드로이드와 SM5사이의 데이터 전송 포맷은 이전 8.1,8.2에서 설명했으니 이 절에서는 설명을 제외하였다. 
아래 그림은 본 어플리케이션의 동작 화면이다. 
<br>
![image](https://user-images.githubusercontent.com/22141977/117795303-0808f300-b289-11eb-99bc-3ea077c37853.png)
![image](https://user-images.githubusercontent.com/22141977/117795319-0a6b4d00-b289-11eb-9ba7-84d4cea64690.png)
![image](https://user-images.githubusercontent.com/22141977/117795333-0ccda700-b289-11eb-8acf-544908623ec3.png)

